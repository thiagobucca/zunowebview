<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Extension Field - Contentstack com Preview</title>
    <script src="https://unpkg.com/@contentstack/ui-extensions-sdk@2.2.0/dist/ui-extension-sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.5;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .left-panel {
            flex: 1;
            background: white;
            padding: 24px;
            overflow-y: auto;
            height: 100vh;
        }

        /* Custom scrollbar for left panel */
        .left-panel {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
        }

        .left-panel::-webkit-scrollbar {
            width: 2px;
        }

        .left-panel::-webkit-scrollbar-track {
            background: transparent;
        }

        .left-panel::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
        }

        .left-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .right-panel {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: sticky;
            top: 0;
            height: 100vh;
            background: #f8f9fa;
            background-image: radial-gradient(circle, #d0d0d0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 24px;
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h2 {
            color: #34495e;
            margin: 24px 0 16px 0;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .field-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #555;
        }

        input,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .categories-section {
            margin: 24px 0;
        }

        .categories-accordion {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .category-accordion {
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .category-accordion.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .category-header {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            background: #f8f9fa;
            border-bottom: 1px solid transparent;
            transition: all 0.2s ease;
        }

        .category-header:hover {
            background: #e9ecef;
        }

        .category-accordion.expanded .category-header {
            border-bottom-color: #ddd;
        }

        .category-drag-handle {
            margin-right: 8px;
            color: #999;
            cursor: grab;
            font-size: 14px;
            line-height: 1;
        }

        .category-drag-handle:active {
            cursor: grabbing;
        }

        .category-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin: 0 12px 0 0;
        }

        .category-name {
            font-weight: 500;
            color: #333;
            flex: 1;
        }

        .category-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .accordion-arrow {
            font-size: 12px;
            color: #666;
            transition: transform 0.2s ease;
        }

        .category-accordion.expanded .accordion-arrow {
            transform: rotate(90deg);
        }

        .category-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .category-accordion.expanded .category-content {
            max-height: 2000px;
            padding: 16px;
        }

        .layout-selector {
            margin-bottom: 20px;
        }

        .layout-selector h4 {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: #333;
        }

        .layout-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .layout-option {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            background: white;
        }

        .layout-option:hover {
            border-color: #007bff;
            transform: translateY(-1px);
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.1);
        }

        .layout-option.selected {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .layout-option span {
            display: block;
            margin-top: 4px;
            font-size: 9px;
            font-weight: 500;
            color: #333;
        }

        .layout-visual {
            width: 30px;
            height: 22px;
            margin: 0 auto 2px auto;
            border-radius: 2px;
            overflow: hidden;
        }

        .layout-1 .layout-visual {
            background: linear-gradient(to bottom, #ff69b4 0%, #ff69b4 100%);
            border-radius: 6px;
            width: 58px;
            height: 82px;
        }

        .layout-2 .layout-visual {
            background: transparent;
            border-radius: 6px;
            width: 58px;
            height: 82px;
            position: relative;
        }

        .layout-2 .layout-visual::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 68%;
            background: #ff69b4;
            border-radius: 4px 4px 4px 4px;
        }

        .layout-2 .layout-visual::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 28%;
            background: #ff69b4;
            border-radius: 4px 4px 3px 3px;
        }

        .layout-3 .layout-visual {
            background: transparent;
            border-radius: 6px;
            width: 58px;
            height: 82px;
            position: relative;
        }

        .layout-3 .layout-visual::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 37%;
            background: #ff69b4;
            border-radius: 4px 4px 6px 6px;
        }

        .layout-3 .layout-visual::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 26px;
            height: 59%;
            background: #ff69b4;
            border-radius: 4px 4px 4px 4px;
            box-shadow: 30px 0 0 0 #ff69b4;
        }

        .layout-4 .layout-visual {
            background: transparent;
            width: 58px;
            height: 82px;
            position: relative;
            margin-top: 2px;
        }

        .layout-4 .layout-visual::before {
            content: '';
            position: absolute;
            top: 0px;
            left: 0;
            right: 0;
            height: 24px;
            background: #ff69b4;
            border-radius: 3px;
        }

        .layout-4 .layout-visual::after {
            content: '';
            position: absolute;
            top: 28px;
            left: 0;
            right: 0;
            height: 24px;
            background: #ff69b4;
            border-radius: 3px;
            box-shadow: 0 28px 0 0 #ff69b4;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.configured {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.empty {
            background: #f8d7da;
            color: #721c24;
        }

        .configure-button {
            padding: 6px 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .configure-button:hover {
            background: #0056b3;
        }

        .active-config {
            margin-top: 24px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .active-config.hidden {
            display: none;
        }

        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .config-header h3 {
            color: #2c3e50;
            font-size: 16px;
            margin: 0;
        }

        .cancel-button {
            padding: 6px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .cancel-button:hover {
            background: #c82333;
        }

        .layouts-section {
            margin-bottom: 24px;
        }

        .layouts-title {
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 600;
            color: #555;
        }

        .layouts-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .layout-option {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            background: white;
        }

        .layout-option:hover {
            border-color: #007bff;
        }

        .layout-option.selected {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .layout-visual {
            width: 100%;
            height: 90px;
            margin-bottom: 8px;
            border-radius: 4px;
            position: relative;
        }

        .layout-name {
            font-size: 12px;
            font-weight: 500;
            color: #666;
        }

        .fields-section {
            margin-top: 20px;
        }

        .fields-section.hidden {
            display: none;
        }

        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            background: white;
        }

        .card-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .card-fields {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .field-input {
            font-size: 13px;
        }

        /* Clean Minimalist Toggle */
        .toggle-switch {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 8px;
        }

        .toggle-input {
            display: none;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            gap: 10px;
        }

        .toggle-inner {
            position: relative;
            width: 44px;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle-inner::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .toggle-input:checked+.toggle-label .toggle-inner {
            background: #000066;
        }

        .toggle-input:checked+.toggle-label .toggle-inner::before {
            transform: translateX(24px);
        }

        .toggle-switch-text {
            font-size: 12px;
            color: #374151;
            font-weight: 400;
            letter-spacing: 0.025em;
        }

        .field-group:has(.toggle-switch) {
            display: flex;
            align-items: center;
            margin-top: 8px;
        }

        /* Phone Preview Styles */
        .phone-container {
            width: 400px;
            height: 800px;
            background: #000;
            border-radius: 30px;
            padding: 10px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            position: relative;
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: #f5f5f5;
            border-radius: 22px;
            overflow-x: visible; /* Permite scroll horizontal dos chips */
            overflow-y: hidden; /* Mantém controle vertical */
            position: relative;
        }

        .phone-header {
            height: 44px;
            background: #f5f5f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            color: #000;
        }

        .phone-status-icons {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .phone-close {
            position: absolute;
            top: 60px;
            right: 30px;
            width: 24px;
            height: 24px;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #444;
            font-weight: 600;
            z-index: 20;
        }

        .phone-avatar {
            position: absolute;
            top: 110px;
            left: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 15;
            transition: opacity 0.3s ease;
        }

        .phone-avatar.hidden-on-scroll {
            opacity: 0;
            pointer-events: none;
        }

        .phone-content {
            height: calc(100% - 44px);
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Custom scrollbar for phone preview */
        .phone-content {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.08) transparent;
        }

        .phone-content::-webkit-scrollbar {
            width: 1px;
        }

        .phone-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .phone-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.08);
            border-radius: 2px;
        }

        .phone-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .phone-initial-content {
            padding: 130px 0 20px 0;
            position: relative;
            z-index: 2;
        }

        .phone-sticky-header {
            position: sticky;
            top: -200px;
            background: #f5f5f5;
            z-index: 10;
            padding: 0px 0px 0px 0px;
            border-bottom: none;
            transition: top 0.3s ease, padding 0.3s ease, border-bottom 0.3s ease;
        }

        .phone-sticky-header.scrolled {
            top: 0;
            padding: 2px 0px 14px 0px;
            padding-top: 62px;
            margin-top: -64px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .phone-background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .phone-background-overlay.hidden-on-scroll {
            opacity: 0;
        }

        .phone-scrollable-content {
            padding: 20px;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 200px);
        }

        .phone-text {
            background: transparent;
            padding: 0;
            border-radius: 0;
            margin: 0 20px 8px 20px;
            font-size: 16px;
            color: #000000;
            line-height: 1.4;
            font-weight: 700;
            opacity: 1;
            transition: opacity 0.3s ease;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
        }

        .phone-text.hidden-on-scroll {
            opacity: 0;
            pointer-events: none;
        }

        .phone-chips {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
            overflow-x: auto;
            scrollbar-width: thin;
            margin: 0 20px 0 20px;
            padding-right: 20px;
            margin-right: 0;
            /* Firefox */
        }

        .phone-chips::-webkit-scrollbar {
            height: 1px;
            /* Chrome, Safari and Opera */
        }

        .phone-chips::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 1px;
        }

        .phone-chips::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 1px;
        }

        .phone-chips::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        .phone-chips-in-content {
            margin-bottom: 20px;
        }

        .phone-chip {
            padding: 12px 16px;
            background: #fff;
            border: 0px solid #e0e0e0;
            border-radius: 12px;
            font-size: 12px;
            color: #000;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 6px;
            height: 36px;
        }

        .phone-chip.active {
            background: #fff;
            color: #000;
            border: 1px solid #ff6b35;
        }

        .phone-chip.selected {
            background: #fff;
            color: #000;
            border: 2px solid #ff6b35;
            border-radius: 12px;
        }

        .phone-chip.edit {
            background: #ff6b35;
            color: #fff;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .phone-offers {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .preview-message {
            border-radius: 12px;
            padding: 32px 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            border: 1px dashed #d1cece;
        }

        .preview-message-icon {
            width: 40px;
            height: 40px;
            background: #f0f0f0;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 4px;
        }

        .preview-message-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0;
            line-height: 1.3;
        }

        .preview-message-subtitle {
            font-size: 14px;
            color: #666;
            margin: 0;
            line-height: 1.4;
        }

        /* Layout 2 Preview Styles */
        .layout2-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout2-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 1px;
            text-align: left;
        }

        .layout2-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout2-card1 {
            position: relative;
            height: 360px;
            border-radius: 12px;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 16px 16px 4px 16px;
            color: white;
        }


        .layout2-card1::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzEycHgiIGhlaWdodD0iMzYwcHgiIHZpZXdCb3g9IjAgMCAzMTIgMzYwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iUmV0w6JuZ3VsbyBsYXJhbmphICNmZjY2MDAiPgogIDxyZWN0IHdpZHRoPSIzMTIiIGhlaWdodD0iMzYwIiBmaWxsPSIjZmY2NjAwIiAvPgo8L3N2Zz4=');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .layout2-card1-content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
        }


        .layout2-card1-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .layout2-card1-title {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .layout2-card1-description {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
        }

        .layout2-card1-arrow {
            font-size: 24px;
            margin-left: 12px;
            opacity: 0.9;
        }

        .layout2-card2 {
            background: white;
            border-radius: 12px;
            padding: 16px;
            position: relative;
            height: 144px;
        }

        .layout2-card2-icon {
            position: absolute;
            top: 16px;
            left: 16px;
            font-size: 24px;
        }

        .layout2-card2-content {
            margin-top: 56px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
        }

        .layout2-card2-text {
            flex: 1;
        }

        .layout2-card2-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .layout2-card2-description {
            font-size: 12px;
            color: #666;
            line-height: 1.3;
        }

        .layout2-card2-arrow {
            font-size: 20px;
            color: #666;
            margin-left: 12px;
        }

        /* Layout 3 Preview Styles */
        .layout3-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout3-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 1px;
            text-align: left;
        }

        .layout3-card1 {
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
            border-radius: 12px;
            padding: 16px;
            color: white;
            position: relative;
            height: 120px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .layout3-card1-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .layout3-card1-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .layout3-card1-title {
            font-size: 12px;
            opacity: 0.9;
            margin: 0;
        }

        .layout3-card1-description {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            margin: 0;
        }

        .layout3-cards-row {
            display: flex;
            gap: 12px;
        }

        .layout3-card {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 16px;
            height: 144px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .layout3-card-icon {
            font-size: 24px;
            color: #ff6b35;
            margin-bottom: 8px;
        }

        .layout3-card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .layout3-card-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .layout3-card-description {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            line-height: 1.3;
            position: relative;
            width: 100%;
            min-width: 0;
        }

        .layout3-card2-description,
        .layout3-card3-description,
        .layout3-card-description {
            position: relative;
            width: 100%;
            min-width: 0;
            padding-right: 24px;
        }

        .layout3-card2-chevron,
        .layout3-card3-chevron,
        .layout3-card-chevron {
            position: absolute;
            bottom: -2px;
            right: 0px;
        }

        /* Layout 1 Preview Styles */
        .layout1-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout1-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 1px;
            text-align: left;
        }

        .layout1-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout1-card-icon {
            font-size: 32px;
            align-self: flex-start;
        }

        .layout1-card-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout1-card-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            text-align: left;
        }

        .layout1-card-description {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            line-height: 1.4;
            text-align: left;
        }

        .layout1-bullets {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 8px 0;
        }

        .layout1-bullet {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .layout1-bullet-icon {
            font-size: 16px;
            color: #28a745;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .layout1-bullet-text {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .layout1-cta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-top: 8px;
        }

        .layout1-cta-arrow {
            font-size: 18px;
            color: #666;
        }

        /* Layout 4 Preview Styles */
        .layout4-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .layout4-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 1px;
            text-align: left;
        }

        .layout4-card1 {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            border-radius: 12px;
            padding: 16px;
            color: white;
            height: 120px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .layout4-card1.white-bg {
            background: white;
            color: #333;
        }

        .layout4-card1-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .layout4-card1-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .layout4-card1-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .layout4-card1-title {
            font-size: 12px;
            opacity: 0.9;
            margin: 0;
        }

        .layout4-card1-description {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            margin: 0;
        }

        .layout4-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .layout4-card-icon {
            font-size: 24px;
            color: #ff6b35;
            margin-bottom: 8px;
        }

        .layout4-card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .layout4-card-footer {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
        }

        .layout4-card-text {
            flex: 1;
        }

        .layout4-card-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .layout4-card-description {
            font-size: 12px;
            color: #666;
            line-height: 1.3;
        }

        .layout4-card-arrow {
            font-size: 18px;
            color: #666;
            margin-left: 12px;
        }

        /* Footer Styles */
        .phone-footer {
            margin-top: auto;
            padding: 20px 0 0 0;
        }

        .footer-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            text-align: left;
        }

        .footer-card {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            border-radius: 12px;
            padding: 16px;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            height: 80px;
        }

        .footer-card-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .footer-card-content {
            flex: 1;
        }

        .footer-card-title {
            font-size: 14px;
            font-weight: 600;
            line-height: 1.3;
        }

        .footer-card-arrow {
            font-size: 18px;
            flex-shrink: 0;
        }

        /* Bullets Section Styles */
        .bullets-section {
            margin: 16px 0;
        }

        .bullets-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .bullet-item {
            margin-bottom: 16px;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #f9f9f9;
        }

        .bullet-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }

        .bullet-fields {
            display: flex;
            gap: 12px;
        }

        .bullet-fields .field-group {
            flex: 1;
            margin-bottom: 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Painel Esquerdo - Configuração -->
        <div class="left-panel">
            <h2><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4C4C4C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-top-icon lucide-panel-top">
                    <rect width="18" height="18" x="3" y="3" rx="2"/>
                    <path d="M3 9h18"/>
                </svg> Header</h2>

            <!-- Campos globais -->
            <div class="field-group">
                <label for="background-image">Imagem de Fundo (URL):</label>
                <input type="text" id="background-image" placeholder="https://exemplo.com/imagem.jpg">
            </div>

            <div class="field-group">
                <label for="main-text">Texto Principal:</label>
                <textarea id="main-text"
                    placeholder="João, com base no seu perfil, preparamos estas ofertas especiais para você!"></textarea>
            </div>

            <h2><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="#4C4C4C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-gallery-vertical-end-icon lucide-gallery-vertical-end">
                    <path d="M7 2h10" />
                    <path d="M5 6h14" />
                    <rect width="18" height="12" x="3" y="10" rx="2" />
                </svg> Interesses</h2>
            <p style="font-size: 12px; color: #666; margin-bottom: 16px;">✓ Marque os interesses, defina o layout e adicione os produtos desejados ⋮⋮
                Arraste para reordenar e definir o peso</p>

            <div class="categories-accordion" id="categories-accordion">
                <!-- Categories will be dynamically generated here -->
            </div>

            <!-- Seção de configuração ativa -->
            <div id="active-config" class="active-config hidden">
                <div class="config-header">
                    <h3 id="config-title">Configurando: --</h3>
                    <button class="cancel-button" onclick="cancelConfiguration()">✕ Cancelar</button>
                </div>

                <!-- Seleção de layout -->
                <div class="layouts-section">
                    <h4 class="layouts-title">Escolha o Layout:</h4>
                    <div class="layouts-grid">
                        <div class="layout-option layout-1" onclick="selectLayout(1)">
                            <div class="layout-visual"></div>
                            <span class="layout-name">Layout 1</span>
                        </div>
                        <div class="layout-option layout-2" onclick="selectLayout(2)">
                            <div class="layout-visual"></div>
                            <span class="layout-name">Layout 2</span>
                        </div>
                        <div class="layout-option layout-3" onclick="selectLayout(3)">
                            <div class="layout-visual"></div>
                            <span class="layout-name">Layout 3</span>
                        </div>
                        <div class="layout-option layout-4" onclick="selectLayout(4)">
                            <div class="layout-visual"></div>
                            <span class="layout-name">Layout 4</span>
                        </div>
                    </div>
                </div>

                <!-- Campos do Layout 2 -->
                <div id="fields-layout-2" class="fields-section hidden">
                    <div class="cards-container">
                        <div class="card-item">
                            <div class="card-title">Card 1 (Com Imagem de Fundo)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout2-card1-bg">Imagem de Background:</label>
                                    <input type="text" id="layout2-card1-bg" class="field-input"
                                        placeholder="URL da imagem">
                                </div>
                                <div class="field-group">
                                    <label for="layout2-card1-title">Título da Oferta:</label>
                                    <input type="text" id="layout2-card1-title" class="field-input"
                                        placeholder="Cofrinhos">
                                </div>
                                <div class="field-group">
                                    <label for="layout2-card1-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout2-card1-description" class="field-input"
                                        placeholder="Organize suas economias e realize seus planos">
                                </div>
                                <div class="field-group">
                                    <label for="layout2-card1-deeplink">Deeplink:</label>
                                    <input type="text" id="layout2-card1-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>

                        <div class="card-item">
                            <div class="card-title">Card 2 (Fundo Branco)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout2-card2-icon">Ícone:</label>
                                    <input type="text" id="layout2-card2-icon" class="field-input"
                                        placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-no-axes-column-increasing-icon lucide-chart-no-axes-column-increasing"><path d="M5 21v-6"/><path d="M12 21V9"/><path d="M19 21V3"/></svg>'>
                                </div>
                                <div class="field-group">
                                    <label for="layout2-card2-title">Título da Oferta:</label>
                                    <input type="text" id="layout2-card2-title" class="field-input"
                                        placeholder="Investimentos">
                                </div>
                                <div class="field-group">
                                    <label for="layout2-card2-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout2-card2-description" class="field-input"
                                        placeholder="Encontre sua aplicação">
                                </div>
                                <div class="field-group">
                                    <label for="layout2-card2-deeplink">Deeplink:</label>
                                    <input type="text" id="layout2-card2-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campos do Layout 1 -->
                <div id="fields-layout-1" class="fields-section hidden">

                    <div class="cards-container">
                        <div class="card-item">
                            <div class="card-title">Card Principal</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout1-icon">Ícone:</label>
                                    <input type="text" id="layout1-icon" class="field-input" placeholder="🛡️">
                                </div>
                                <div class="field-group">
                                    <label for="layout1-title">Título da Oferta:</label>
                                    <input type="text" id="layout1-title" class="field-input"
                                        placeholder="Seguro Transações">
                                </div>
                                <div class="field-group">
                                    <label for="layout1-description">Descrição da Oferta:</label>
                                    <textarea id="layout1-description" class="field-input"
                                        placeholder="Proteção extra contra imprevistos para sua conta e cartão"></textarea>
                                </div>

                                <div class="bullets-section">
                                    <div class="bullets-title">Bullets (até 3):</div>

                                    <div class="bullet-item">
                                        <div class="bullet-title">Bullet 1:</div>
                                        <div class="bullet-fields">
                                            <div class="field-group">
                                                <label for="layout1-bullet1-icon">Ícone:</label>
                                                <input type="text" id="layout1-bullet1-icon" class="field-input"
                                                    placeholder="✓">
                                            </div>
                                            <div class="field-group">
                                                <label for="layout1-bullet1-text">Texto:</label>
                                                <input type="text" id="layout1-bullet1-text" class="field-input"
                                                    placeholder="Roubo de itens pessoais até R$ 1,5 mil">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="bullet-item">
                                        <div class="bullet-title">Bullet 2:</div>
                                        <div class="bullet-fields">
                                            <div class="field-group">
                                                <label for="layout1-bullet2-icon">Ícone:</label>
                                                <input type="text" id="layout1-bullet2-icon" class="field-input"
                                                    placeholder="✓">
                                            </div>
                                            <div class="field-group">
                                                <label for="layout1-bullet2-text">Texto:</label>
                                                <input type="text" id="layout1-bullet2-text" class="field-input"
                                                    placeholder="Furto e roubo após saque até R$ 1 mil">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="bullet-item">
                                        <div class="bullet-title">Bullet 3:</div>
                                        <div class="bullet-fields">
                                            <div class="field-group">
                                                <label for="layout1-bullet3-icon">Ícone:</label>
                                                <input type="text" id="layout1-bullet3-icon" class="field-input"
                                                    placeholder="✓">
                                            </div>
                                            <div class="field-group">
                                                <label for="layout1-bullet3-text">Texto:</label>
                                                <input type="text" id="layout1-bullet3-text" class="field-input"
                                                    placeholder="Uso forçado de conta e cartão até R$ 10 mil">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="field-group">
                                    <label for="layout1-cta">Call to Action:</label>
                                    <input type="text" id="layout1-cta" class="field-input"
                                        placeholder="Contratar seguro">
                                </div>
                                <div class="field-group">
                                    <label for="layout1-deeplink">Deeplink:</label>
                                    <input type="text" id="layout1-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campos do Layout 4 -->
                <div id="fields-layout-4" class="fields-section hidden">

                    <div class="cards-container">
                        <div class="card-item">
                            <div class="card-title">Card 1 (Azul Marinho - Principal)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout4-card1-icon">Ícone:</label>
                                    <input type="text" id="layout4-card1-icon" class="field-input"
                                        placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#feffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'>
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card1-title">Título da Oferta:</label>
                                    <input type="text" id="layout4-card1-title" class="field-input"
                                        placeholder="Previdência">
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card1-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout4-card1-description" class="field-input"
                                        placeholder="Um futuro mais tranquilo">
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card1-deeplink">Deeplink:</label>
                                    <input type="text" id="layout4-card1-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card1-blue-bg">Usar cor do segmento:</label>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="layout4-card1-blue-bg" class="toggle-input" checked>
                                        <label for="layout4-card1-blue-bg" class="toggle-label">
                                            <span class="toggle-inner"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card-item">
                            <div class="card-title">Card 2 (Branco)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout4-card2-icon">Ícone:</label>
                                    <input type="text" id="layout4-card2-icon" class="field-input"
                                        placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'>
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card2-title">Título da Oferta:</label>
                                    <input type="text" id="layout4-card2-title" class="field-input"
                                        placeholder="Investimentos">
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card2-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout4-card2-description" class="field-input"
                                        placeholder="Um futuro mais tranquilo">
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card2-deeplink">Deeplink:</label>
                                    <input type="text" id="layout4-card2-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>

                        <div class="card-item">
                            <div class="card-title">Card 3 (Branco)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout4-card3-icon">Ícone:</label>
                                    <input type="text" id="layout4-card3-icon" class="field-input"
                                        placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'>
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card3-title">Título da Oferta:</label>
                                    <input type="text" id="layout4-card3-title" class="field-input"
                                        placeholder="Cofrinhos">
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card3-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout4-card3-description" class="field-input"
                                        placeholder="Organize suas economias e realize seus planos">
                                </div>
                                <div class="field-group">
                                    <label for="layout4-card3-deeplink">Deeplink:</label>
                                    <input type="text" id="layout4-card3-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campos do Layout 3 -->
                <div id="fields-layout-3" class="fields-section hidden">
                    <div class="cards-container">
                        <div class="card-item">
                            <div class="card-title">Card 1 (Laranja - Principal)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout3-card1-icon">Ícone:</label>
                                    <input type="text" id="layout3-card1-icon" class="field-input"
                                        placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#feffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'>
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card1-title">Título da Oferta:</label>
                                    <input type="text" id="layout3-card1-title" class="field-input"
                                        placeholder="Previdência">
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card1-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout3-card1-description" class="field-input"
                                        placeholder="Garanta um futuro tranquilo">
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card1-deeplink">Deeplink:</label>
                                    <input type="text" id="layout3-card1-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>

                        <div class="card-item">
                            <div class="card-title">Card 2 (Branco - Esquerdo)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout3-card2-icon">Ícone:</label>
                                    <input type="text" id="layout3-card2-icon" class="field-input"
                                        placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'>
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card2-title">Título da Oferta:</label>
                                    <input type="text" id="layout3-card2-title" class="field-input"
                                        placeholder="Assessoria de investimentos">
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card2-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout3-card2-description" class="field-input"
                                        placeholder="Otimize o seu rendimento">
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card2-deeplink">Deeplink:</label>
                                    <input type="text" id="layout3-card2-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>

                        <div class="card-item">
                            <div class="card-title">Card 3 (Branco - Direito)</div>
                            <div class="card-fields">
                                <div class="field-group">
                                    <label for="layout3-card3-icon">Ícone:</label>
                                    <input type="text" id="layout3-card3-icon" class="field-input"
                                        placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'>
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card3-title">Título da Oferta:</label>
                                    <input type="text" id="layout3-card3-title" class="field-input"
                                        placeholder="Conta Itaú">
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card3-description">Descrição da Oferta:</label>
                                    <input type="text" id="layout3-card3-description" class="field-input"
                                        placeholder="Controle seus rendimentos no mesmo app">
                                </div>
                                <div class="field-group">
                                    <label for="layout3-card3-deeplink">Deeplink:</label>
                                    <input type="text" id="layout3-card3-deeplink" class="field-input"
                                        placeholder="URL do deeplink">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campos dinâmicos serão inseridos aqui -->
                <div id="dynamic-fields"></div>
            </div>

            <h2><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="#4C4C4C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-panel-bottom-icon lucide-panel-bottom">
                    <rect width="18" height="18" x="3" y="3" rx="2" />
                    <path d="M3 15h18" />
                </svg> Footer</h2>

            <div class="field-group">
                <label for="footer-title">Título do Footer:</label>
                <input type="text" id="footer-title" placeholder="Título do Footer">
            </div>

            <div class="field-group">
                <label for="footer-card-title">Título da Oferta:</label>
                <input type="text" id="footer-card-title" placeholder="Descrição do Footer">
            </div>
        </div>

        <!-- Painel Direito - Preview -->
        <div class="right-panel">
            <div class="phone-container">
                <div class="phone-screen">
                    <div class="phone-header">
                        <span id="phone-time">20:05</span>
                        <div class="phone-status-icons">
                            <span>•••</span>
                            <span>📶</span>
                            <span>📶</span>
                            <span>🔋</span>
                        </div>
                    </div>

                    <div class="phone-content" id="phone-content">
                        <div class="phone-background-overlay" id="phone-background-overlay"></div>

                        <div class="phone-close">✕</div>

                        <div class="phone-avatar">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"
                                fill="none" stroke="#ff6b35" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-user-icon lucide-user">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                        </div>

                        <div class="phone-initial-content">
                            <div class="phone-text" id="phone-text">João, com base no seu perfil,
preparamos estas ofertas especiais para você!</div>

                            <div class="phone-chips phone-chips-in-content" id="phone-chips-content">
                                <div class="phone-chip">Interesse 1</div>
                                <div class="phone-chip">Interesse 2</div>
                            </div>
                        </div>

                        <div class="phone-sticky-header">
                            <div class="phone-chips" id="phone-chips-header">
                                <div class="phone-chip">Interesse 1</div>
                                <div class="phone-chip">Interesse 2</div>
                            </div>
                        </div>

                        <div class="phone-scrollable-content">
                            <div class="phone-offers" id="phone-offers">
                                <div class="preview-message">Configure uma categoria para ver o preview aqui</div>
                            </div>

                            <div class="phone-footer" id="phone-footer">
                                <div class="footer-title" id="footer-title-preview">Título do Footer</div>
                                <div class="footer-card" id="footer-card-preview">
                                    <div class="footer-card-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                            height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                            class="lucide lucide-pencil-icon lucide-pencil">
                                            <path
                                                d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
                                            <path d="m15 5 4 4" />
                                        </svg></div>
                                    <div class="footer-card-content">
                                        <div class="footer-card-title">Descrição do Footer</div>
                                    </div>
                                    <div class="footer-card-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                            height="16" viewBox="0 0 24 24" fill="none" stroke="#feffff"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                            class="lucide lucide-chevron-right-icon lucide-chevron-right">
                                            <path d="m9 18 6-6-6-6" />
                                        </svg></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentCategory = null;
        let currentLayout = null;
        let categoriesData = {};
        let extension = null;

        // Categories definition with UUID, name and SVG icon
        const categoriesDefinition = {
            'credito': {
                uuid: 'cat-001-credito',
                name: 'Crédito',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'
            },
            'debito': {
                uuid: 'cat-002-debito',
                name: 'Débito',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'
            },
            'beneficios': {
                uuid: 'cat-003-beneficios',
                name: 'Benefícios',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'
            },
            'protecao': {
                uuid: 'cat-004-protecao',
                name: 'Proteção',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'
            },
            'organizacaofinanceira': {
                uuid: 'cat-005-organizacaofinanceira',
                name: 'Organização Financeira',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>'
            }
        };

        // Inicialização do SDK do Contentstack
        function initExtension() {
            try {
                if (typeof ContentstackUIExtension !== 'undefined') {
                    ContentstackUIExtension.init().then(function (extensionObj) {
                        extension = extensionObj;
                        
                        // Definir altura da extensão
                        extension.window.updateHeight(800);
                        
                        // Carregar dados existentes
                        loadExistingData();
                        
                        console.log('Contentstack Extension initialized successfully');
                    }).catch(function (error) {
                        console.error('Error initializing Contentstack Extension:', error);
                        // Fallback para modo standalone
                        initStandaloneMode();
                    });
                } else {
                    console.warn('ContentstackUIExtension not available, running in standalone mode');
                    initStandaloneMode();
                }
            } catch (error) {
                console.error('Error during extension initialization:', error);
                initStandaloneMode();
            }
        }

        // Modo standalone para testes locais
        function initStandaloneMode() {
            extension = {
                field: {
                    getData: function() {
                        const data = localStorage.getItem('contentstack_extension_data');
                        return data ? JSON.parse(data) : {};
                    },
                    setData: function(data) {
                        localStorage.setItem('contentstack_extension_data', JSON.stringify(data));
                        return Promise.resolve();
                    }
                },
                window: {
                    updateHeight: function(height) {
                        console.log('Update height to:', height);
                    }
                }
            };
            
            loadExistingData();
            console.log('Running in standalone mode');
        }

        // Carregar dados existentes
        function loadExistingData() {
            try {
                const existingData = extension.field.getData();
                if (existingData && Object.keys(existingData).length > 0) {
                    // Carregar dados globais
                    if (existingData.backgroundImage) {
                        document.getElementById('background-image').value = existingData.backgroundImage;
                    }
                    if (existingData.mainText) {
                        document.getElementById('main-text').value = existingData.mainText;
                    }
                    if (existingData.footerTitle) {
                        document.getElementById('footer-title').value = existingData.footerTitle;
                    }
                    if (existingData.footerCardTitle) {
                        document.getElementById('footer-card-title').value = existingData.footerCardTitle;
                    }
                    
                    // Carregar dados das categorias
                    if (existingData.categories) {
                        categoriesData = existingData.categories;
                        
                        // Marcar checkboxes das categorias selecionadas
                        Object.keys(categoriesData).forEach(category => {
                            const checkbox = document.getElementById(`cat-${category}`);
                            if (checkbox && categoriesData[category].selected) {
                                checkbox.checked = true;
                            }
                        });
                    }
                    
                    updateCategoryStatus();
                    updatePreview();
                }
            } catch (error) {
                console.error('Error loading existing data:', error);
            }
        }

        // Salvar dados no Contentstack
        function saveData() {
            try {
                const data = {
                    backgroundImage: document.getElementById('background-image').value,
                    mainText: document.getElementById('main-text').value,
                    footerTitle: document.getElementById('footer-title').value,
                    footerCardTitle: document.getElementById('footer-card-title').value,
                    categories: categoriesData
                };
                
                extension.field.setData(data).then(() => {
                    console.log('Data saved successfully');
                }).catch((error) => {
                    console.error('Error saving data:', error);
                });
            } catch (error) {
                console.error('Error in saveData:', error);
            }
        }

        // Function to generate accordion HTML dynamically
        function generateCategoryAccordions() {
            const accordionContainer = document.getElementById('categories-accordion');
            accordionContainer.innerHTML = '';

            Object.keys(categoriesDefinition).forEach(categoryKey => {
                const category = categoriesDefinition[categoryKey];

                const accordionHTML = `
                    <div class="category-accordion" data-category="${categoryKey}">
                        <div class="category-header">
                            <div class="category-drag-handle">⋮⋮</div>
                            <input type="checkbox" id="cat-${categoryKey}" class="category-checkbox">
                            <span class="category-name">${category.name}</span>
                            <div class="category-status">
                                <span id="status-${categoryKey}" class="status-badge empty">Vazio</span>
                                <span class="accordion-arrow">▶</span>
                            </div>
                        </div>
                        <div class="category-content">
                            <!-- Layout selection and configuration will go here -->
                            <div class="layout-selector">
                                <h4>Escolha o Layout:</h4>
                                <div class="layout-grid">
                                    <div class="layout-option" data-layout="1">
                                        <div class="layout-visual">
                                            <div class="layout-1">
                                                <div class="layout-visual"></div>
                                            </div>
                                        </div>
                                        <span>Layout 1</span>
                                    </div>
                                    <div class="layout-option" data-layout="2">
                                        <div class="layout-visual">
                                            <div class="layout-2">
                                                <div class="layout-visual"></div>
                                            </div>
                                        </div>
                                        <span>Layout 2</span>
                                    </div>
                                    <div class="layout-option" data-layout="3">
                                        <div class="layout-visual">
                                            <div class="layout-3">
                                                <div class="layout-visual"></div>
                                            </div>
                                        </div>
                                        <span>Layout 3</span>
                                    </div>
                                    <div class="layout-option" data-layout="4">
                                        <div class="layout-visual">
                                            <div class="layout-4">
                                                <div class="layout-visual"></div>
                                            </div>
                                        </div>
                                        <span>Layout 4</span>
                                    </div>
                                </div>
                            </div>
                            <div class="category-fields" id="fields-${categoryKey}">
                                <!-- Fields will be inserted here based on selected layout -->
                            </div>
                        </div>
                    </div>
                `;

                accordionContainer.insertAdjacentHTML('beforeend', accordionHTML);
            });
        }

        function updatePhoneTime() {
            const now = new Date();
            // Converter para fuso horário do Brasil (GMT-3 / America/Sao_Paulo)
            const brazilTime = now.toLocaleTimeString('pt-BR', {
                timeZone: 'America/Sao_Paulo',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
            
            const phoneTimeElement = document.getElementById('phone-time');
            if (phoneTimeElement) {
                phoneTimeElement.textContent = brazilTime;
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function () {
            generateCategoryAccordions();
            setupEventListeners();
            setupScrollBehavior();
            updatePreview();
            updatePhoneTime();
            
            // Inicializar extensão do Contentstack
            initExtension();
        });

        function setupEventListeners() {
            // Listeners para campos globais
            document.getElementById('background-image').addEventListener('input', function() {
                updatePreview();
                saveData();
            });
            document.getElementById('main-text').addEventListener('input', function() {
                updatePreview();
                saveData();
            });
            document.getElementById('footer-title').addEventListener('input', function() {
                updateFooterPreview();
                saveData();
            });
            document.getElementById('footer-card-title').addEventListener('input', function() {
                updateFooterPreview();
                saveData();
            });

            // Listeners para checkboxes das categorias
            Object.keys(categoriesDefinition).forEach(category => {
                const checkbox = document.getElementById(`cat-${category}`);
                if (checkbox) {
                    checkbox.addEventListener('change', function() {
                        updatePreview();
                        saveData();
                    });
                }
            });

            // Setup accordion functionality
            setupAccordions();
            setupDragAndDrop();
        }

        function setupAccordions() {
            // Setup accordion headers click
            document.querySelectorAll('.category-header').forEach(header => {
                header.addEventListener('click', function (e) {
                    // Don't trigger accordion if clicking on checkbox or drag handle
                    if (e.target.closest('.category-checkbox') || e.target.closest('.category-drag-handle')) {
                        return;
                    }

                    const accordion = this.closest('.category-accordion');
                    const isExpanded = accordion.classList.contains('expanded');

                    // Close all other accordions
                    document.querySelectorAll('.category-accordion.expanded').forEach(acc => {
                        if (acc !== accordion) {
                            acc.classList.remove('expanded');
                        }
                    });

                    // Toggle current accordion
                    accordion.classList.toggle('expanded', !isExpanded);

                    // Initialize layout options if opening
                    if (!isExpanded) {
                        const category = accordion.dataset.category;
                        initializeCategoryContent(category);
                    }
                });
            });

            // Initialize layout options for all categories immediately
            document.querySelectorAll('.category-accordion').forEach(accordion => {
                const category = accordion.dataset.category;
                initializeCategoryContent(category);
            });
        }

        function setupDragAndDrop() {
            const accordion = document.getElementById('categories-accordion');
            let draggedElement = null;

            // Add drag event listeners to each category
            document.querySelectorAll('.category-accordion').forEach(category => {
                // Set draggable only when mousedown on handle
                const handle = category.querySelector('.category-drag-handle');

                handle.addEventListener('mousedown', function () {
                    category.draggable = true;
                });

                category.addEventListener('mouseup', function () {
                    category.draggable = false;
                });

                category.addEventListener('mouseleave', function () {
                    category.draggable = false;
                });

                category.addEventListener('dragstart', function (e) {
                    draggedElement = this;
                    this.classList.add('dragging');

                    // Set drag effect
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.outerHTML);
                });

                category.addEventListener('dragend', function () {
                    this.classList.remove('dragging');

                    // Always update preview when drag ends (regardless of successful drop)
                    setTimeout(() => {
                        updatePreview();
                        saveData();
                    }, 100);

                    draggedElement = null;
                    this.draggable = false;
                });

                category.addEventListener('dragover', function (e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';

                    // Add visual feedback
                    const afterElement = getDragAfterElement(accordion, e.clientY);
                    if (afterElement == null) {
                        accordion.appendChild(draggedElement);
                    } else {
                        accordion.insertBefore(draggedElement, afterElement);
                    }
                });

                category.addEventListener('drop', function (e) {
                    e.preventDefault();

                    // Update preview order after drop
                    setTimeout(() => {
                        updatePreview();
                        saveData();
                    }, 50);
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.category-accordion:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function initializeCategoryContent(category) {
            console.log('initializeCategoryContent called for:', category);
            // Add layout option click listeners
            const accordion = document.querySelector(`[data-category="${category}"]`);
            const layoutOptions = accordion.querySelectorAll('.layout-option');
            console.log('Found layout options:', layoutOptions.length);

            layoutOptions.forEach((option, index) => {
                option.addEventListener('click', function () {
                    console.log('Layout option clicked:', this.dataset.layout, 'for category:', category);

                    // Remove selected class from all options in this category
                    layoutOptions.forEach(opt => opt.classList.remove('selected'));

                    // Add selected class to clicked option
                    this.classList.add('selected');

                    // Get layout number
                    const layoutNum = parseInt(this.dataset.layout);

                    // Initialize category data if not exists
                    if (!categoriesData[category]) {
                        categoriesData[category] = {};
                    }

                    // Set layout
                    categoriesData[category].layout = layoutNum;
                    categoriesData[category].selected = true;

                    // Generate fields for this layout and category
                    generateLayoutFields(category, layoutNum);

                    // Update status and preview
                    updateCategoryStatus();
                    updatePreview();
                    saveData();
                });
            });

            // Load existing layout selection if any
            if (categoriesData[category] && categoriesData[category].layout) {
                const layoutNum = categoriesData[category].layout;
                const layoutOption = accordion.querySelector(`[data-layout="${layoutNum}"]`);
                if (layoutOption) {
                    layoutOption.classList.add('selected');
                    generateLayoutFields(category, layoutNum);
                }
            }
        }

        function generateLayoutFields(category, layoutNum) {
            const fieldsContainer = document.getElementById(`fields-${category}`);
            if (!fieldsContainer) {
                console.error('Fields container not found for category:', category);
                return;
            }

            console.log('Generating fields for category:', category, 'layout:', layoutNum);

            switch (layoutNum) {
                case 1:
                    fieldsContainer.innerHTML = `
                        <div class="cards-container">
                            <div class="card-item">
                                <div class="card-title">Card Principal</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout1-${category}-icon">Ícone:</label>
                                        <input type="text" id="layout1-${category}-icon" class="field-input" placeholder="🛡️" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout1-${category}-title">Título da Oferta:</label>
                                        <input type="text" id="layout1-${category}-title" class="field-input" placeholder="Seguro Transações" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout1-${category}-description">Descrição da Oferta:</label>
                                        <textarea id="layout1-${category}-description" class="field-input" placeholder="Proteção extra contra imprevistos para sua conta e cartão" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();"></textarea>
                                    </div>

                                    <div class="bullets-section">
                                        <div class="bullets-title">Bullets (até 3):</div>

                                        <div class="bullet-item">
                                            <div class="bullet-title">Bullet 1:</div>
                                            <div class="bullet-fields">
                                                <div class="field-group">
                                                    <label for="layout1-${category}-bullet1-icon">Ícone:</label>
                                                    <input type="text" id="layout1-${category}-bullet1-icon" class="field-input" placeholder="✓" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                                </div>
                                                <div class="field-group">
                                                    <label for="layout1-${category}-bullet1-text">Texto:</label>
                                                    <input type="text" id="layout1-${category}-bullet1-text" class="field-input" placeholder="Roubo de itens pessoais até R$ 1,5 mil" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="bullet-item">
                                            <div class="bullet-title">Bullet 2:</div>
                                            <div class="bullet-fields">
                                                <div class="field-group">
                                                    <label for="layout1-${category}-bullet2-icon">Ícone:</label>
                                                    <input type="text" id="layout1-${category}-bullet2-icon" class="field-input" placeholder="✓" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                                </div>
                                                <div class="field-group">
                                                    <label for="layout1-${category}-bullet2-text">Texto:</label>
                                                    <input type="text" id="layout1-${category}-bullet2-text" class="field-input" placeholder="Furto e roubo após saque até R$ 1 mil" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="bullet-item">
                                            <div class="bullet-title">Bullet 3:</div>
                                            <div class="bullet-fields">
                                                <div class="field-group">
                                                    <label for="layout1-${category}-bullet3-icon">Ícone:</label>
                                                    <input type="text" id="layout1-${category}-bullet3-icon" class="field-input" placeholder="✓" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                                </div>
                                                <div class="field-group">
                                                    <label for="layout1-${category}-bullet3-text">Texto:</label>
                                                    <input type="text" id="layout1-${category}-bullet3-text" class="field-input" placeholder="Uso forçado de conta e cartão até R$ 10 mil" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="field-group">
                                        <label for="layout1-${category}-cta">Call to Action:</label>
                                        <input type="text" id="layout1-${category}-cta" class="field-input" placeholder="Contratar seguro" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout1-${category}-deeplink">Deeplink:</label>
                                        <input type="text" id="layout1-${category}-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 2:
                    fieldsContainer.innerHTML = `
                        <div class="cards-container">
                            <div class="card-item">
                                <div class="card-title">Card 1 (Com Imagem de Fundo)</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout2-${category}-card1-bg">Imagem de Background:</label>
                                        <input type="text" id="layout2-${category}-card1-bg" class="field-input" placeholder="URL da imagem" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout2-${category}-card1-title">Título da Oferta:</label>
                                        <input type="text" id="layout2-${category}-card1-title" class="field-input" placeholder="Cofrinhos" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout2-${category}-card1-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout2-${category}-card1-description" class="field-input" placeholder="Organize suas economias e realize seus planos" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout2-${category}-card1-deeplink">Deeplink:</label>
                                        <input type="text" id="layout2-${category}-card1-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>

                            <div class="card-item">
                                <div class="card-title">Card 2 (Fundo Branco)</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout2-${category}-card2-icon">Ícone:</label>
                                        <input type="text" id="layout2-${category}-card2-icon" class="field-input" placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-no-axes-column-increasing-icon lucide-chart-no-axes-column-increasing"><path d="M5 21v-6"/><path d="M12 21V9"/><path d="M19 21V3"/></svg>' oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout2-${category}-card2-title">Título da Oferta:</label>
                                        <input type="text" id="layout2-${category}-card2-title" class="field-input" placeholder="Investimentos" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout2-${category}-card2-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout2-${category}-card2-description" class="field-input" placeholder="Encontre sua aplicação" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout2-${category}-card2-deeplink">Deeplink:</label>
                                        <input type="text" id="layout2-${category}-card2-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 3:
                    fieldsContainer.innerHTML = `
                        <div class="cards-container">
                            <div class="card-item">
                                <div class="card-title">Card 1 (Laranja - Principal)</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout3-${category}-card1-icon">Ícone:</label>
                                        <input type="text" id="layout3-${category}-card1-icon" class="field-input" placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#feffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>' oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card1-title">Título da Oferta:</label>
                                        <input type="text" id="layout3-${category}-card1-title" class="field-input" placeholder="Previdência" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card1-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout3-${category}-card1-description" class="field-input" placeholder="Garanta um futuro tranquilo" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card1-deeplink">Deeplink:</label>
                                        <input type="text" id="layout3-${category}-card1-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-item">
                                <div class="card-title">Card 2 (Branco - Esquerdo)</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout3-${category}-card2-icon">Ícone:</label>
                                        <input type="text" id="layout3-${category}-card2-icon" class="field-input" placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>' oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card2-title">Título da Oferta:</label>
                                        <input type="text" id="layout3-${category}-card2-title" class="field-input" placeholder="Assessoria de investimentos" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card2-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout3-${category}-card2-description" class="field-input" placeholder="Otimize o seu rendimento" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card2-deeplink">Deeplink:</label>
                                        <input type="text" id="layout3-${category}-card2-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>

                            <div class="card-item">
                                <div class="card-title">Card 3 (Branco - Direito)</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout3-${category}-card3-icon">Ícone:</label>
                                        <input type="text" id="layout3-${category}-card3-icon" class="field-input" placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>' oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card3-title">Título da Oferta:</label>
                                        <input type="text" id="layout3-${category}-card3-title" class="field-input" placeholder="Conta Itaú" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card3-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout3-${category}-card3-description" class="field-input" placeholder="Controle seus rendimentos no mesmo app" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout3-${category}-card3-deeplink">Deeplink:</label>
                                        <input type="text" id="layout3-${category}-card3-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 4:
                    fieldsContainer.innerHTML = `
                        <div class="cards-container">
                            <div class="card-item">
                                <div class="card-title">Card 1 (Principal)</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout4-${category}-card1-icon">Ícone:</label>
                                        <input type="text" id="layout4-${category}-card1-icon" class="field-input" placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#feffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>' oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card1-title">Título da Oferta:</label>
                                        <input type="text" id="layout4-${category}-card1-title" class="field-input" placeholder="Previdência" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card1-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout4-${category}-card1-description" class="field-input" placeholder="Um futuro mais tranquilo" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card1-deeplink">Deeplink:</label>
                                        <input type="text" id="layout4-${category}-card1-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card1-blue-bg">Usar cor do segmento:</label>
                                        <div class="toggle-switch">
                                            <input type="checkbox" id="layout4-${category}-card1-blue-bg" class="toggle-input" checked oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                            <label for="layout4-${category}-card1-blue-bg" class="toggle-label">
                                                <span class="toggle-inner"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-item">
                                <div class="card-title">Card 2</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout4-${category}-card2-icon">Ícone:</label>
                                        <input type="text" id="layout4-${category}-card2-icon" class="field-input" placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>' oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card2-title">Título da Oferta:</label>
                                        <input type="text" id="layout4-${category}-card2-title" class="field-input" placeholder="Investimentos" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card2-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout4-${category}-card2-description" class="field-input" placeholder="Um futuro mais tranquilo" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card2-deeplink">Deeplink:</label>
                                        <input type="text" id="layout4-${category}-card2-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>

                            <div class="card-item">
                                <div class="card-title">Card 3</div>
                                <div class="card-fields">
                                    <div class="field-group">
                                        <label for="layout4-${category}-card3-icon">Ícone:</label>
                                        <input type="text" id="layout4-${category}-card3-icon" class="field-input" placeholder='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-icon lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>' oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card3-title">Título da Oferta:</label>
                                        <input type="text" id="layout4-${category}-card3-title" class="field-input" placeholder="Cofrinhos" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card3-description">Descrição da Oferta:</label>
                                        <input type="text" id="layout4-${category}-card3-description" class="field-input" placeholder="Organize suas economias e realize seus planos" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                    <div class="field-group">
                                        <label for="layout4-${category}-card3-deeplink">Deeplink:</label>
                                        <input type="text" id="layout4-${category}-card3-deeplink" class="field-input" placeholder="URL do deeplink" oninput="saveCurrentCategoryData(); updateCategoryStatus(); updatePreview(); saveData();">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                default:
                    fieldsContainer.innerHTML = `<p>Layout ${layoutNum} em desenvolvimento...</p>`;
            }

            // Populate existing data if any
            if (categoriesData[category] && categoriesData[category].data) {
                populateFieldsWithData(category, layoutNum, categoriesData[category].data);
            }
        }

        function populateFieldsWithData(category, layout, data) {
            switch (layout) {
                case 1:
                    if (data.icon) document.getElementById(`layout1-${category}-icon`).value = data.icon;
                    if (data.title) document.getElementById(`layout1-${category}-title`).value = data.title;
                    if (data.description) document.getElementById(`layout1-${category}-description`).value = data.description;
                    if (data.cta) document.getElementById(`layout1-${category}-cta`).value = data.cta;
                    if (data.deeplink) document.getElementById(`layout1-${category}-deeplink`).value = data.deeplink;
                    
                    if (data.bullets) {
                        data.bullets.forEach((bullet, index) => {
                            const bulletNum = index + 1;
                            if (bullet.icon) document.getElementById(`layout1-${category}-bullet${bulletNum}-icon`).value = bullet.icon;
                            if (bullet.text) document.getElementById(`layout1-${category}-bullet${bulletNum}-text`).value = bullet.text;
                        });
                    }
                    break;
                case 2:
                    if (data.card1) {
                        if (data.card1.bg) document.getElementById(`layout2-${category}-card1-bg`).value = data.card1.bg;
                        if (data.card1.title) document.getElementById(`layout2-${category}-card1-title`).value = data.card1.title;
                        if (data.card1.description) document.getElementById(`layout2-${category}-card1-description`).value = data.card1.description;
                        if (data.card1.deeplink) document.getElementById(`layout2-${category}-card1-deeplink`).value = data.card1.deeplink;
                    }
                    if (data.card2) {
                        if (data.card2.icon) document.getElementById(`layout2-${category}-card2-icon`).value = data.card2.icon;
                        if (data.card2.title) document.getElementById(`layout2-${category}-card2-title`).value = data.card2.title;
                        if (data.card2.description) document.getElementById(`layout2-${category}-card2-description`).value = data.card2.description;
                        if (data.card2.deeplink) document.getElementById(`layout2-${category}-card2-deeplink`).value = data.card2.deeplink;
                    }
                    break;
                case 3:
                    if (data.card1) {
                        if (data.card1.icon) document.getElementById(`layout3-${category}-card1-icon`).value = data.card1.icon;
                        if (data.card1.title) document.getElementById(`layout3-${category}-card1-title`).value = data.card1.title;
                        if (data.card1.description) document.getElementById(`layout3-${category}-card1-description`).value = data.card1.description;
                        if (data.card1.deeplink) document.getElementById(`layout3-${category}-card1-deeplink`).value = data.card1.deeplink;
                    }
                    if (data.card2) {
                        if (data.card2.icon) document.getElementById(`layout3-${category}-card2-icon`).value = data.card2.icon;
                        if (data.card2.title) document.getElementById(`layout3-${category}-card2-title`).value = data.card2.title;
                        if (data.card2.description) document.getElementById(`layout3-${category}-card2-description`).value = data.card2.description;
                        if (data.card2.deeplink) document.getElementById(`layout3-${category}-card2-deeplink`).value = data.card2.deeplink;
                    }
                    if (data.card3) {
                        if (data.card3.icon) document.getElementById(`layout3-${category}-card3-icon`).value = data.card3.icon;
                        if (data.card3.title) document.getElementById(`layout3-${category}-card3-title`).value = data.card3.title;
                        if (data.card3.description) document.getElementById(`layout3-${category}-card3-description`).value = data.card3.description;
                        if (data.card3.deeplink) document.getElementById(`layout3-${category}-card3-deeplink`).value = data.card3.deeplink;
                    }
                    break;
                case 4:
                    if (data.card1) {
                        if (data.card1.icon) document.getElementById(`layout4-${category}-card1-icon`).value = data.card1.icon;
                        if (data.card1.title) document.getElementById(`layout4-${category}-card1-title`).value = data.card1.title;
                        if (data.card1.description) document.getElementById(`layout4-${category}-card1-description`).value = data.card1.description;
                        if (data.card1.deeplink) document.getElementById(`layout4-${category}-card1-deeplink`).value = data.card1.deeplink;
                        if (data.card1.blueBg !== undefined) document.getElementById(`layout4-${category}-card1-blue-bg`).checked = data.card1.blueBg;
                    }
                    if (data.card2) {
                        if (data.card2.icon) document.getElementById(`layout4-${category}-card2-icon`).value = data.card2.icon;
                        if (data.card2.title) document.getElementById(`layout4-${category}-card2-title`).value = data.card2.title;
                        if (data.card2.description) document.getElementById(`layout4-${category}-card2-description`).value = data.card2.description;
                        if (data.card2.deeplink) document.getElementById(`layout4-${category}-card2-deeplink`).value = data.card2.deeplink;
                    }
                    if (data.card3) {
                        if (data.card3.icon) document.getElementById(`layout4-${category}-card3-icon`).value = data.card3.icon;
                        if (data.card3.title) document.getElementById(`layout4-${category}-card3-title`).value = data.card3.title;
                        if (data.card3.description) document.getElementById(`layout4-${category}-card3-description`).value = data.card3.description;
                        if (data.card3.deeplink) document.getElementById(`layout4-${category}-card3-deeplink`).value = data.card3.deeplink;
                    }
                    break;
            }
        }

        function saveCurrentCategoryData() {
            // This function will be called by the input fields to save data
            // We need to determine which category is currently being edited
            const expandedAccordion = document.querySelector('.category-accordion.expanded');
            if (!expandedAccordion) return;

            const category = expandedAccordion.dataset.category;
            if (!categoriesData[category] || !categoriesData[category].layout) return;

            const layout = categoriesData[category].layout;
            const data = collectFieldData(category, layout);

            if (!categoriesData[category]) {
                categoriesData[category] = {};
            }
            categoriesData[category].data = data;
        }

        function collectFieldData(category, layout) {
            const data = {};

            switch (layout) {
                case 1:
                    data.icon = document.getElementById(`layout1-${category}-icon`)?.value || '';
                    data.title = document.getElementById(`layout1-${category}-title`)?.value || '';
                    data.description = document.getElementById(`layout1-${category}-description`)?.value || '';
                    data.cta = document.getElementById(`layout1-${category}-cta`)?.value || '';
                    data.deeplink = document.getElementById(`layout1-${category}-deeplink`)?.value || '';
                    
                    data.bullets = [];
                    for (let i = 1; i <= 3; i++) {
                        const icon = document.getElementById(`layout1-${category}-bullet${i}-icon`)?.value || '';
                        const text = document.getElementById(`layout1-${category}-bullet${i}-text`)?.value || '';
                        if (icon || text) {
                            data.bullets.push({ icon, text });
                        }
                    }
                    break;
                case 2:
                    data.card1 = {
                        bg: document.getElementById(`layout2-${category}-card1-bg`)?.value || '',
                        title: document.getElementById(`layout2-${category}-card1-title`)?.value || '',
                        description: document.getElementById(`layout2-${category}-card1-description`)?.value || '',
                        deeplink: document.getElementById(`layout2-${category}-card1-deeplink`)?.value || ''
                    };
                    data.card2 = {
                        icon: document.getElementById(`layout2-${category}-card2-icon`)?.value || '',
                        title: document.getElementById(`layout2-${category}-card2-title`)?.value || '',
                        description: document.getElementById(`layout2-${category}-card2-description`)?.value || '',
                        deeplink: document.getElementById(`layout2-${category}-card2-deeplink`)?.value || ''
                    };
                    break;
                case 3:
                    data.card1 = {
                        icon: document.getElementById(`layout3-${category}-card1-icon`)?.value || '',
                        title: document.getElementById(`layout3-${category}-card1-title`)?.value || '',
                        description: document.getElementById(`layout3-${category}-card1-description`)?.value || '',
                        deeplink: document.getElementById(`layout3-${category}-card1-deeplink`)?.value || ''
                    };
                    data.card2 = {
                        icon: document.getElementById(`layout3-${category}-card2-icon`)?.value || '',
                        title: document.getElementById(`layout3-${category}-card2-title`)?.value || '',
                        description: document.getElementById(`layout3-${category}-card2-description`)?.value || '',
                        deeplink: document.getElementById(`layout3-${category}-card2-deeplink`)?.value || ''
                    };
                    data.card3 = {
                        icon: document.getElementById(`layout3-${category}-card3-icon`)?.value || '',
                        title: document.getElementById(`layout3-${category}-card3-title`)?.value || '',
                        description: document.getElementById(`layout3-${category}-card3-description`)?.value || '',
                        deeplink: document.getElementById(`layout3-${category}-card3-deeplink`)?.value || ''
                    };
                    break;
                case 4:
                    data.card1 = {
                        icon: document.getElementById(`layout4-${category}-card1-icon`)?.value || '',
                        title: document.getElementById(`layout4-${category}-card1-title`)?.value || '',
                        description: document.getElementById(`layout4-${category}-card1-description`)?.value || '',
                        deeplink: document.getElementById(`layout4-${category}-card1-deeplink`)?.value || '',
                        blueBg: document.getElementById(`layout4-${category}-card1-blue-bg`)?.checked !== false
                    };
                    data.card2 = {
                        icon: document.getElementById(`layout4-${category}-card2-icon`)?.value || '',
                        title: document.getElementById(`layout4-${category}-card2-title`)?.value || '',
                        description: document.getElementById(`layout4-${category}-card2-description`)?.value || '',
                        deeplink: document.getElementById(`layout4-${category}-card2-deeplink`)?.value || ''
                    };
                    data.card3 = {
                        icon: document.getElementById(`layout4-${category}-card3-icon`)?.value || '',
                        title: document.getElementById(`layout4-${category}-card3-title`)?.value || '',
                        description: document.getElementById(`layout4-${category}-card3-description`)?.value || '',
                        deeplink: document.getElementById(`layout4-${category}-card3-deeplink`)?.value || ''
                    };
                    break;
            }

            return data;
        }

        function setupScrollBehavior() {
            const phoneContent = document.getElementById('phone-content');
            const phoneText = document.getElementById('phone-text');
            const phoneBackground = document.getElementById('phone-background-overlay');
            const phoneAv
